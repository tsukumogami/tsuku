# PROJ source build from GitHub
# Used for testing cmake_build action with dependencies
# Tests: download + extract + setup_build_env + cmake_build

[metadata]
name = "proj-source"
description = "Cartographic projections library (source build for testing)"
homepage = "https://proj.org/"
dependencies = ["sqlite-source"]

[version]
source = "homebrew"
formula = "proj"

[[steps]]
action = "download"
url = "https://github.com/OSGeo/PROJ/archive/{version}.tar.gz"
skip_verification_reason = "GitHub source archives don't provide checksums"

[[steps]]
action = "extract"
archive = "{version}.tar.gz"
format = "tar.gz"

[[steps]]
action = "setup_build_env"

[[steps]]
action = "cmake_build"
source_dir = "PROJ-{version}"
executables = ["proj"]
cmake_args = ["-DBUILD_TESTING=OFF", "-DENABLE_TIFF=OFF", "-DENABLE_CURL=OFF"]

[[steps]]
action = "install_binaries"
install_mode = "directory"
binaries = ["bin/proj"]

[verify]
command = "proj"
pattern = "{version}"
