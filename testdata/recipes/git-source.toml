# Ground truth recipe for git (source build with complex dependencies)
# Used for testing configure_make action with multiple library dependencies
# Tests: download + extract + setup_build_env + configure_make with curl, openssl, zlib, expat

[metadata]
name = "git-source"
description = "Distributed revision control system (source build for testing)"
homepage = "https://git-scm.com/"
dependencies = ["curl", "openssl", "zlib", "expat"]

[version]
source = "homebrew"
formula = "git"

[[steps]]
action = "download"
url = "https://mirrors.edge.kernel.org/pub/software/scm/git/git-{version}.tar.xz"

[[steps]]
action = "extract"
archive = "git-{version}.tar.xz"
format = "tar.xz"

[[steps]]
action = "setup_build_env"

[[steps]]
action = "configure_make"
source_dir = "git-{version}"
configure_args = ["--with-curl", "--with-openssl", "--with-zlib", "--with-expat"]
executables = ["git"]

[[steps]]
action = "set_rpath"
binaries = [".install/bin/git"]
rpath = "$ORIGIN/../lib:{libs_dir}/curl-8.12.1/lib:{libs_dir}/openssl-3.6.0/lib:{libs_dir}/zlib-1.3.1/lib:{libs_dir}/expat-2.6.5/lib"

[[steps]]
action = "install_binaries"
install_mode = "directory"
binaries = ["bin/git"]

[verify]
command = "git --version"
pattern = "git version {version}"
