# Ground truth recipe for readline (source build with patches)
# Used by LLM integration tests (llm_homebrew_readline_multi_patches)
# Tests: download + extract + configure_make with multiple p0 patches
# Note: Patches use version-specific URLs (readline83-XXX for 8.3)

[metadata]
name = "readline-source"
description = "GNU Readline library (source build for testing)"
homepage = "https://tiswww.case.edu/php/chet/readline/rltop.html"
type = "library"
dependencies = ["make"]

[version]
source = "homebrew"
formula = "readline"

[[steps]]
action = "download"
url = "https://ftpmirror.gnu.org/gnu/readline/readline-{version}.tar.gz"
signature_url = "https://ftpmirror.gnu.org/gnu/readline/readline-{version}.tar.gz.sig"
signature_key_url = "https://tiswww.case.edu/php/chet/gpgkey.asc"
signature_key_fingerprint = "7C0135FB088AAF6C66C650B9BB5869F064EA74AB"

[[steps]]
action = "extract"
archive = "readline-{version}.tar.gz"
format = "tar.gz"
strip_dirs = 1

[[steps]]
action = "configure_make"
source_dir = "."
executables = []

# Patches from GNU FTP (p0 strip level)
[[patches]]
url = "https://ftpmirror.gnu.org/gnu/readline/readline-8.3-patches/readline83-001"
checksum = "21f0a03106dbe697337cd25c70eb0edbaa2bdb6d595b45f83285cdd35bac84de"
strip = 0

[[patches]]
url = "https://ftpmirror.gnu.org/gnu/readline/readline-8.3-patches/readline83-002"
checksum = "e27364396ba9f6debf7cbaaf1a669e2b2854241ae07f7eca74ca8a8ba0c97472"
strip = 0

[[patches]]
url = "https://ftpmirror.gnu.org/gnu/readline/readline-8.3-patches/readline83-003"
checksum = "72dee13601ce38f6746eb15239999a7c56f8e1ff5eb1ec8153a1f213e4acdb29"
strip = 0

[verify]
command = "ls lib/libreadline.a"
pattern = "libreadline"
mode = "output"
