# Ground truth recipe for bash (source build with multiple patches)
# Used by LLM integration tests (S3)
# Tests: download_file + extract + configure_make with multiple patches

[metadata]
name = "bash-source"
description = "Bourne Again SHell (source build for testing)"
homepage = "https://www.gnu.org/software/bash/"
dependencies = ["make"]

[version]
source = "homebrew"
formula = "bash"

[[steps]]
action = "download_file"
url = "https://ftpmirror.gnu.org/gnu/bash/bash-5.3.tar.gz"
dest = "bash-5.3.tar.gz"
checksum = "0d5cd86965f869a26cf64f4b71be7b96f90a3ba8b3d74e27e8e9d9d5550f31ba"

[[steps]]
action = "extract"
archive = "bash-5.3.tar.gz"
format = "tar.gz"
strip_dirs = 1

[[steps]]
action = "configure_make"
source_dir = "."
executables = ["bash"]

# Multiple patches from GNU FTP (p0 strip level) - order matters
[[patches]]
url = "https://ftpmirror.gnu.org/gnu/bash/bash-5.3-patches/bash53-001"
strip = 0

[[patches]]
url = "https://ftpmirror.gnu.org/gnu/bash/bash-5.3-patches/bash53-002"
strip = 0

[[patches]]
url = "https://ftpmirror.gnu.org/gnu/bash/bash-5.3-patches/bash53-003"
strip = 0

[[patches]]
url = "https://ftpmirror.gnu.org/gnu/bash/bash-5.3-patches/bash53-004"
strip = 0

[[patches]]
url = "https://ftpmirror.gnu.org/gnu/bash/bash-5.3-patches/bash53-005"
strip = 0

[[patches]]
url = "https://ftpmirror.gnu.org/gnu/bash/bash-5.3-patches/bash53-006"
strip = 0

[[patches]]
url = "https://ftpmirror.gnu.org/gnu/bash/bash-5.3-patches/bash53-007"
strip = 0

[[patches]]
url = "https://ftpmirror.gnu.org/gnu/bash/bash-5.3-patches/bash53-008"
strip = 0

[[patches]]
url = "https://ftpmirror.gnu.org/gnu/bash/bash-5.3-patches/bash53-009"
strip = 0

[verify]
command = "bash --version"
pattern = "GNU bash, version {version}"
