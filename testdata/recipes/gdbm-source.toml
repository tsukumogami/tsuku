# Test recipe for validating configure_make action
# This builds gdbm from source instead of using pre-built bottles
# Used by build-essentials CI workflow

[metadata]
name = "gdbm-source"
description = "GNU database manager (source build for testing)"
homepage = "https://www.gnu.org/software/gdbm/"
dependencies = ["make"]

[version]
source = "homebrew"
formula = "gdbm"

[[steps]]
action = "download_file"
url = "https://ftpmirror.gnu.org/gnu/gdbm/gdbm-1.26.tar.gz"
dest = "gdbm-1.26.tar.gz"
checksum = "6a24504a14de4a744103dcb936be976df6fbe88ccff26065e54c1c47946f4a5e"

[[steps]]
action = "extract"
archive = "gdbm-1.26.tar.gz"
format = "tar.gz"
strip_dirs = 1

[[steps]]
action = "configure_make"
source_dir = "."
executables = ["gdbmtool"]
configure_args = ["--disable-silent-rules", "--enable-libgdbm-compat", "--without-readline", "--disable-nls", "--disable-dependency-tracking", "MAKEINFO=true"]

[verify]
command = "gdbmtool --version"
pattern = "gdbmtool (GDBM) {version}"
