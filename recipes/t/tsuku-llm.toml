# tsuku-llm - Local LLM inference engine
#
# GPU-accelerated inference powered by llama.cpp. Requires a GPU with at
# least 8 GB VRAM to run the minimum supported model (7B).
#
# Variant selection is automatic via GPU hardware detection:
#   - macOS: Metal (all Macs have Metal-capable GPUs)
#   - Linux + NVIDIA GPU: CUDA variant (depends on cuda-runtime)
#   - Linux + AMD/Intel GPU: Vulkan variant (depends on vulkan-loader)

[metadata]
name = "tsuku-llm"
description = "Local LLM inference engine"
homepage = "https://github.com/tsukumogami/tsuku-llm"
supported_os = ["linux", "darwin"]
supported_arch = ["amd64", "arm64"]
supported_libc = ["glibc"]
unsupported_reason = "All variants are built against glibc. musl/Alpine Linux is not supported because llama.cpp and CUDA runtime libraries require glibc. Windows is not supported because the release pipeline does not produce Windows artifacts."

# macOS arm64: Metal variant (all Apple Silicon Macs have Metal-capable GPUs)
[[steps]]
action = "github_file"
when = { os = ["darwin"], arch = "arm64" }
repo = "tsukumogami/tsuku-llm"
asset_pattern = "tsuku-llm-v{version}-darwin-arm64"
binary = "tsuku-llm"

# macOS amd64: Metal variant (Intel Macs with Metal-capable GPUs)
[[steps]]
action = "github_file"
when = { os = ["darwin"], arch = "amd64" }
repo = "tsukumogami/tsuku-llm"
asset_pattern = "tsuku-llm-v{version}-darwin-amd64"
binary = "tsuku-llm"

# Linux amd64: CUDA variant for NVIDIA GPUs
[[steps]]
action = "github_file"
when = { os = ["linux"], arch = "amd64", gpu = ["nvidia"] }
dependencies = ["cuda-runtime"]
repo = "tsukumogami/tsuku-llm"
asset_pattern = "tsuku-llm-v{version}-linux-amd64-cuda"
binary = "tsuku-llm"

# Linux amd64: Vulkan variant for AMD/Intel GPUs
[[steps]]
action = "github_file"
when = { os = ["linux"], arch = "amd64", gpu = ["amd", "intel"] }
dependencies = ["vulkan-loader"]
repo = "tsukumogami/tsuku-llm"
asset_pattern = "tsuku-llm-v{version}-linux-amd64-vulkan"
binary = "tsuku-llm"

# Linux arm64: CUDA variant for NVIDIA GPUs
[[steps]]
action = "github_file"
when = { os = ["linux"], arch = "arm64", gpu = ["nvidia"] }
dependencies = ["cuda-runtime"]
repo = "tsukumogami/tsuku-llm"
asset_pattern = "tsuku-llm-v{version}-linux-arm64-cuda"
binary = "tsuku-llm"

# Linux arm64: Vulkan variant for AMD/Intel GPUs
[[steps]]
action = "github_file"
when = { os = ["linux"], arch = "arm64", gpu = ["amd", "intel"] }
dependencies = ["vulkan-loader"]
repo = "tsukumogami/tsuku-llm"
asset_pattern = "tsuku-llm-v{version}-linux-arm64-vulkan"
binary = "tsuku-llm"

[verify]
command = "tsuku-llm --version"
pattern = "{version}"
