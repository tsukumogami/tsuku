[metadata]
name = "curl"
description = "Command line tool for transferring data with URLs"
homepage = "https://curl.se/"
dependencies = ["openssl", "zlib"]
binaries = ["bin/curl"]

[version]
source = "homebrew"
formula = "curl"

# NOTE: curl.se provides PGP signatures but not SHA256SUMS; checksum computed during plan generation
[[steps]]
action = "download"
url = "https://curl.se/download/curl-{version}.tar.gz"

[[steps]]
action = "extract"
archive = "curl-{version}.tar.gz"
format = "tar.gz"

[[steps]]
action = "setup_build_env"

[[steps]]
action = "configure_make"
source_dir = "curl-{version}"
configure_args = ["--with-openssl", "--with-zlib", "--disable-silent-rules", "--without-libpsl"]
executables = ["curl"]

# NOTE: set_rpath only targets the binary, not the shared library, for cross-platform
# compatibility. macOS uses .dylib while Linux uses .so for library naming.
# See issue #653 for future improvement of cross-platform library RPATH support.
[[steps]]
action = "set_rpath"
binaries = [".install/bin/curl"]
rpath = "$ORIGIN/../lib:{libs_dir}/openssl-3.6.0/lib:{libs_dir}/zlib-1.3.1/lib"

[[steps]]
action = "install_binaries"
install_mode = "directory"
binaries = ["bin/curl"]

[verify]
command = "curl --version"
pattern = "curl {version}"
