# GCC Runtime Libraries - libstdc++ and libgcc_s
# These are needed by binaries compiled with GCC (like nodejs)
# Extracted from Homebrew's gcc bottle
# Only needed on Linux - macOS provides these via system frameworks

[metadata]
name = "gcc-libs"
description = "GCC runtime libraries (libstdc++, libgcc_s)"
homepage = "https://gcc.gnu.org/"
type = "library"

[version]
source = "homebrew"
formula = "gcc"

# Linux: download gcc bottle and extract runtime libraries
[[steps]]
action = "homebrew"
formula = "gcc"
[steps.when]
os = "linux"

# Flatten library files to lib/ directory for easy linking
# The homebrew bottle has libs in lib/gcc/{version}/ subdirectories
[[steps]]
action = "run_command"
command = '''
mkdir -p lib
# Copy the actual library files (find the real files, not symlinks)
cp lib/gcc/current/libstdc++.so.6.0.* lib/
cp lib/gcc/current/libgcc_s.so.1 lib/
# Create standard symlinks with explicit targets
cd lib
STDCXX=$(ls libstdc++.so.6.0.* 2>/dev/null | head -1)
ln -sf "$STDCXX" libstdc++.so.6
ln -sf libstdc++.so.6 libstdc++.so
ln -sf libgcc_s.so.1 libgcc_s.so
'''
description = "Flattening library files to lib/"
[steps.when]
os = "linux"

[[steps]]
action = "install_libraries"
patterns = ["lib/libstdc++.so*", "lib/libgcc_s.so*"]
[steps.when]
os = "linux"
