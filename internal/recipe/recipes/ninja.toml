[metadata]
name = "ninja"
description = "Small build system with a focus on speed"
homepage = "https://ninja-build.org/"
binaries = ["bin/ninja"]

[version]
source = "homebrew"
formula = "ninja"

# glibc Linux and macOS: Build from source
[[steps]]
action = "download"
url = "https://github.com/ninja-build/ninja/archive/v{version}.tar.gz"
skip_verification_reason = "GitHub source archives don't provide checksums"
when = { os = ["darwin", "linux"], libc = ["glibc"] }

[[steps]]
action = "extract"
archive = "v{version}.tar.gz"
format = "tar.gz"
when = { os = ["darwin", "linux"], libc = ["glibc"] }

[[steps]]
action = "cmake_build"
source_dir = "ninja-{version}"
executables = ["ninja"]
cmake_args = ["-DBUILD_TESTING=OFF"]
when = { os = ["darwin", "linux"], libc = ["glibc"] }

[[steps]]
action = "install_binaries"
install_mode = "directory"
outputs = ["bin/ninja"]
when = { os = ["darwin", "linux"], libc = ["glibc"] }

# musl Linux: System packages
[[steps]]
action = "apk_install"
packages = ["ninja-build"]
when = { os = ["linux"], libc = ["musl"] }

[verify]
command = "ninja --version"
pattern = "{version}"
