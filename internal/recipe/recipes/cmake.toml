[metadata]
name = "cmake"
description = "Cross-platform build system generator"
homepage = "https://cmake.org/"
binaries = ["bin/cmake", "bin/ctest", "bin/cpack"]

# glibc Linux: Homebrew bottles with step-level dependencies
[[steps]]
action = "homebrew"
formula = "cmake"
when = { os = ["linux"], libc = ["glibc"] }
dependencies = ["openssl", "patchelf"]

[[steps]]
action = "set_rpath"
binaries = ["bin/cmake", "bin/ctest", "bin/cpack", "bin/ccmake"]
rpath = "$ORIGIN/../lib:{libs_dir}/openssl-{deps.openssl.version}/lib"
when = { os = ["linux"], libc = ["glibc"] }

[[steps]]
action = "install_binaries"
install_mode = "directory"
outputs = ["bin/cmake", "bin/ctest", "bin/cpack", "bin/ccmake"]
when = { os = ["linux"], libc = ["glibc"] }

# musl Linux: System packages (apk handles transitive deps)
[[steps]]
action = "apk_install"
packages = ["cmake"]
when = { os = ["linux"], libc = ["musl"] }

# macOS: Homebrew
[[steps]]
action = "homebrew"
formula = "cmake"
when = { os = ["darwin"] }

[[steps]]
action = "install_binaries"
install_mode = "directory"
outputs = ["bin/cmake", "bin/ctest", "bin/cpack", "bin/ccmake"]
when = { os = ["darwin"] }

[verify]
command = "cmake --version"
pattern = "cmake version {version}"
